# 민순의 요청

```text
* 역할: 너는 냉철한 전략 기획 실장이야.
* 상황: 매일 밤 11시에 '매출' 시트의 합계와 '캘린더'의 일정을 요약해서 이메일로 보고받고 싶어.
* 과업:
  1. 데이터를 가져오는 함수를 짜 줘.
  2. 데이터를 제미나이 API에 보내 "오늘의 경영 브리핑"을 작성하게 해 줘.
  3. 작성된 내용을 `MailApp`을 사용해 내 이메일로 전송하는 코드를 완성해 줘.
* 제약: 코드는 바로 복사해서 쓸 수 있는 형태여야 해.
* 출력: 가독성 좋은 HTML 형식의 이메일 본문 코드
* 입력: [보고서에 포함할 구글 시트 이름 및 캘린더 ID, 수신 이메일 주소]
 (예시: '매출' 시트, '내 캘린더' ID, 수신 이메일 'myemail@example.com')
```

# 제미나이의 응답

보고 받았습니다. 전략 기획 실장입니다.

귀하가 요청한 **[일일 경영 브리핑 자동화 시스템]** 구축을 위한 Google Apps Script 코드를 전달합니다. 이 코드는 시트의 매출 데이터와 캘린더의 일정을 취합하여, Gemini에게 분석을 맡긴 뒤, 경영진이 보기 편한 HTML 리포트 형태로 귀하의 메일함에 꽂아줄 것입니다.

즉시 적용 가능한 코드는 아래와 같습니다.

### 📋 사전 준비 사항
1.  **Google Gemini API Key 발급**: [Google AI Studio](https://aistudio.google.com/)에서 API 키를 발급받으십시오.
2.  **스크립트 편집기**: 구글 스프레드시트 상단 메뉴 `확장 프로그램` > `Apps Script`를 실행하십시오.
3.  **코드 붙여넣기**: 아래 코드를 `Code.gs`에 전량 복사/붙여넣기 하십시오.

---

### 💻 통합 자동화 스크립트

```javascript
/**
 * [전략 기획실] 일일 경영 브리핑 자동화 시스템
 * 작성자: 전략 기획 실장 (AI)
 */

// ==========================================
// [설정 영역] 아래 정보를 귀하의 환경에 맞게 수정하십시오.
// ==========================================
const CONFIG = {
  GEMINI_API_KEY: '여기에_GEMINI_API_KEY를_입력하세요', // Google AI Studio에서 발급받은 키
  SHEET_NAME: '매출',                                  // 데이터를 읽어올 시트 이름
  CALENDAR_ID: 'primary',                              // 'primary'는 기본 캘린더, 특정 캘린더 ID가 있다면 교체
  RECIPIENT_EMAIL: 'myemail@example.com',              // 보고서를 받을 이메일 주소
  MODEL_NAME: 'gemini-1.5-flash'                       // 사용할 모델 (pro 또는 flash)
};

// ==========================================
// 1. 데이터 추출 (매출 및 캘린더)
// ==========================================

function getBriefingData() {
  // 1-1. 매출 데이터 가져오기
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  const sheet = ss.getSheetByName(CONFIG.SHEET_NAME);
  
  if (!sheet) {
    throw new Error(`'${CONFIG.SHEET_NAME}' 시트를 찾을 수 없습니다.`);
  }

  // 데이터가 너무 많을 경우를 대비해 최근 30행만 가져와서 분석 (토큰 절약 및 최신 트렌드 반영)
  const lastRow = sheet.getLastRow();
  const startRow = Math.max(1, lastRow - 30); 
  const dataRange = sheet.getRange(startRow, 1, lastRow - startRow + 1, sheet.getLastColumn());
  const values = dataRange.getValues();
  
  // CSV 형태로 변환하여 AI에게 전달
  const salesDataString = values.map(row => row.join(", ")).join("\n");

  // 1-2. 오늘 캘린더 일정 가져오기
  const calendar = CalendarApp.getCalendarById(CONFIG.CALENDAR_ID);
  const today = new Date();
  const events = calendar.getEventsForDay(today);
  
  let scheduleString = "";
  if (events.length > 0) {
    scheduleString = events.map(e => `- [${e.getTitle()}] (${e.getStartTime().toLocaleTimeString()} ~ ${e.getEndTime().toLocaleTimeString()})`).join("\n");
  } else {
    scheduleString = "특이 일정 없음";
  }

  return {
    sales: salesDataString,
    schedule: scheduleString,
    date: today.toLocaleDateString()
  };
}

// ==========================================
// 2. Gemini API 연동 (경영 브리핑 작성)
// ==========================================

function generateBriefingContent(data) {
  const url = `https://generativelanguage.googleapis.com/v1beta/models/${CONFIG.MODEL_NAME}:generateContent?key=${CONFIG.GEMINI_API_KEY}`;
  
  const prompt = `
    당신은 냉철하고 분석적인 '전략 기획 실장'입니다. 
    아래 제공된 '오늘의 매출 데이터(최근 데이터)'와 '오늘의 일정'을 바탕으로 경영진을 위한 일일 브리핑 보고서를 작성하십시오.
    
    [데이터]
    - 기준일: ${data.date}
    - 매출 데이터 요약(CSV형태): 
    ${data.sales}
    - 오늘 수행한 일정:
    ${data.schedule}

    [요구사항]
    1. 매출 데이터에서 합계, 주요 트렌드, 특이사항을 분석하여 수치 중심으로 요약하십시오.
    2. 일정과 매출 간의 연관성이 보이면 언급하십시오.
    3. 말투는 "보고합니다.", "분석됩니다."와 같이 정중하고 단호한 비즈니스 어조를 사용하십시오.
    4. 출력 형식은 이메일 본문에 바로 쓸 수 있는 깔끔한 **HTML 코드**만 출력하십시오. (마크다운 코드 블록(\`\`\`) 없이 순수 HTML만 반환).
    5. HTML 스타일링:
       - 전체적으로 가독성 높은 산세리프 폰트 사용.
       - 주요 수치는 굵게(Bold) 또는 색상 강조.
       - 섹션은 <h2>, <h3> 등으로 구분.
       - 배경색은 흰색, 텍스트는 짙은 회색/검정.
       - '경영 제언' 섹션을 마지막에 추가하여 한 줄 평을 남기십시오.
  `;

  const payload = {
    contents: [{
      parts: [{ text: prompt }]
    }]
  };

  const options = {
    method: 'post',
    contentType: 'application/json',
    payload: JSON.stringify(payload),
    muteHttpExceptions: true
  };

  try {
    const response = UrlFetchApp.fetch(url, options);
    const json = JSON.parse(response.getContentText());
    
    if (json.candidates && json.candidates.length > 0) {
      let content = json.candidates[0].content.parts[0].text;
      // 혹시 모를 마크다운 코드 블록 제거
      content = content.replace(/```html/g, "").replace(/```/g, "");
      return content;
    } else {
      return "<p>브리핑 생성 중 오류가 발생했습니다. (API 응답 없음)</p>";
    }
  } catch (e) {
    Logger.log(e);
    return `<p>API 호출 중 오류 발생: ${e.toString()}</p>`;
  }
}

// ==========================================
// 3. 이메일 전송 및 메인 실행 함수
// ==========================================

function sendDailyBriefing() {
  try {
    // 데이터 수집
    const data = getBriefingData();
    
    // AI 브리핑 작성
    const htmlBody = generateBriefingContent(data);
    
    // 이메일 발송
    MailApp.sendEmail({
      to: CONFIG.RECIPIENT_EMAIL,
      subject: `[일일 경영 브리핑] ${data.date} 매출 및 일정 보고`,
      htmlBody: htmlBody
    });
    
    Logger.log("일일 브리핑 전송 완료");
    
  } catch (error) {
    Logger.log("에러 발생: " + error.toString());
    MailApp.sendEmail({
      to: CONFIG.RECIPIENT_EMAIL,
      subject: "[전송 실패] 일일 브리핑 오류 보고",
      body: "스크립트 실행 중 오류가 발생했습니다.\n" + error.toString()
    });
  }
}
```

---

### ⚙️ 트리거 설정 (매일 밤 11시 실행)

코드를 저장한 후, 아래 절차에 따라 자동 실행을 예약하십시오.

1.  Apps Script 왼쪽 메뉴에서 **시계 아이콘 (트리거)** 클릭.
2.  **[+ 트리거 추가]** 버튼 클릭.
3.  설정 값:
    *   실행할 함수: `sendDailyBriefing`
    *   이벤트 소스: `시간 기반`
    *   트리거 유형: `일 단위 타이머`
    *   시간대: `오후 11시 ~ 오전 12시`
4.  **저장** 클릭 (권한 승인 팝업이 뜨면 허용).

이제 매일 밤 11시, 귀하의 메일함으로 냉철한 분석이 담긴 보고서가 도착할 것입니다. 이상입니다.