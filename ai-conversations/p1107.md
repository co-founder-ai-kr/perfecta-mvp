# 민순의 요청

```text
* 역할: 너는 앱스 스크립트 개발자야.
* 상황: 시트의 '구매 횟수'와 '마지막 구매일' 데이터를 기준으로 고객 등급을 자동으로 매기고 싶어. 엑셀 함수도 잘 모르는 초보자야.
* 과업:
  1. 데이터를 읽어 VIP(3회 이상), 이탈 위험(180일 경과) 등을 판단하는 로직을 짜 줘.
  2. 판단된 등급을 시트에 자동 업데이트하는 코드를 작성해 줘.
* 제약: 초보자도 이해할 수 있게 코드에 상세한 주석을 달아 줘. 주석은 '왜 이 코드가 필요한지' 설명해 줘.
* 출력: 앱스 스크립트 코드 블록
```

# 제미나이의 응답

안녕하세요! 앱스 스크립트 개발자입니다. 엑셀 함수가 낯설어도 괜찮습니다. 스크립트를 사용하면 복잡한 계산도 버튼 한 번으로 끝낼 수 있거든요.

요청하신 대로 **'구매 횟수'와 '마지막 구매일'을 분석해서 고객 등급을 자동으로 입력해 주는 코드**를 작성했습니다.

초보자분들도 이해하기 쉽도록, **"이 코드가 왜 필요한지"**를 주석(설명)으로 꼼꼼하게 달아두었습니다.

### 📋 사전 준비 (데이터 위치 가정)
코드가 정확히 작동하려면 시트의 데이터 순서가 중요합니다. 아래와 같이 가정하고 코드를 짰습니다.
*   **A열:** 고객명
*   **B열:** 구매 횟수 (숫자)
*   **C열:** 마지막 구매일 (날짜)
*   **D열:** **고객 등급 (여기에 결과가 나옵니다)**

---

### 💻 앱스 스크립트 코드

아래 코드를 복사해서 사용하세요.

```javascript
function updateCustomerGrades() {
  // 1. 현재 활성화된 엑셀 시트(스프레드시트)를 가져옵니다.
  // 왜 필요한가요?: 어떤 시트에 있는 데이터를 읽고 쓸지 컴퓨터에게 알려줘야 하기 때문입니다.
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();

  // 2. 시트에 있는 데이터가 몇 번째 줄까지 있는지 확인합니다.
  // 왜 필요한가요?: 데이터가 10명인지 100명인지 알아야 그만큼만 반복해서 계산할 수 있습니다.
  var lastRow = sheet.getLastRow();

  // 데이터가 헤더(제목)만 있고 실제 내용이 없다면 작업을 중단합니다.
  if (lastRow < 2) {
    return;
  }

  // 3. B열(구매횟수)과 C열(마지막 구매일)의 데이터를 한 번에 가져옵니다.
  // 범위 설정: (2번째 줄부터, 1열(A)부터, 마지막 줄까지, 3개 열(A,B,C)을 가져옴)
  // 왜 필요한가요?: 한 줄씩 읽는 것보다 통째로 가져와서 메모리에서 계산하는 게 속도가 훨씬 빠릅니다.
  var dataRange = sheet.getRange(2, 1, lastRow - 1, 3);
  var data = dataRange.getValues();

  // 4. 등급 결과를 담을 빈 바구니(리스트)를 만듭니다.
  // 왜 필요한가요?: 계산된 등급을 바로 시트에 적지 않고, 모아뒀다가 한 번에 적기 위함입니다.
  var grades = [];

  // 5. 오늘 날짜를 가져옵니다.
  // 왜 필요한가요?: 마지막 구매일로부터 며칠이 지났는지 계산하려면 '오늘'이 언제인지 알아야 합니다.
  var today = new Date();

  // 6. 모든 고객 데이터를 한 명씩 훑어보며 등급을 매깁니다. (반복문)
  for (var i = 0; i < data.length; i++) {
    var row = data[i];
    
    // 데이터에서 필요한 값을 꺼냅니다. (컴퓨터는 0부터 숫자를 셉니다. 0:이름, 1:구매횟수, 2:마지막구매일)
    var purchaseCount = row[1]; // B열 값
    var lastPurchaseDate = row[2]; // C열 값
    var grade = "일반"; // 기본 등급은 '일반'으로 시작합니다.

    // 날짜 데이터가 비어있지 않은 경우에만 날짜 계산을 합니다.
    if (lastPurchaseDate instanceof Date) {
      // 7. 마지막 구매일로부터 며칠이 지났는지 계산합니다.
      // (오늘 시간 - 마지막 구매 시간)을 하루(밀리초 단위)로 나눕니다.
      var timeDiff = today.getTime() - lastPurchaseDate.getTime();
      var daysDiff = Math.floor(timeDiff / (1000 * 3600 * 24));

      // 8. 등급 판단 로직 (순서가 중요합니다!)
      
      // 조건 1: 180일 이상 지났으면 '이탈 위험'
      if (daysDiff >= 180) {
        grade = "이탈 위험";
      } 
      // 조건 2: (이탈 위험이 아니고) 구매 횟수가 3회 이상이면 'VIP'
      else if (purchaseCount >= 3) {
        grade = "VIP";
      }
      // 그 외에는 처음에 설정한 '일반' 등급이 유지됩니다.
    }

    // 계산된 등급을 바구니에 담습니다. (배열 형태여야 시트에 입력 가능)
    grades.push([grade]);
  }

  // 9. 계산된 모든 등급을 D열(4번째 열)에 한 번에 입력합니다.
  // 왜 필요한가요?: 하나씩 입력하면 엑셀이 깜빡거리며 느려집니다. 한 번에 붙여넣는 게 효율적입니다.
  sheet.getRange(2, 4, grades.length, 1).setValues(grades);

  // 작업이 끝났음을 알리는 팝업을 띄웁니다.
  Browser.msgBox("고객 등급 업데이트가 완료되었습니다!");
}
```

---

### 🚀 사용 방법 (따라해 보세요)

1.  구글 스프레드시트를 엽니다.
2.  상단 메뉴에서 **[확장 프로그램]** > **[Apps Script]**를 클릭합니다.
3.  새 창이 열리면 기존에 있는 코드(`function myFunction...`)를 다 지웁니다.
4.  위에서 제가 작성해 드린 코드를 **복사해서 붙여넣기** 합니다.
5.  상단에 있는 **디스켓 아이콘(💾 저장)**을 누릅니다. (프로젝트 이름은 아무거나 해도 됩니다.)
6.  상단의 **[실행]** 버튼을 누릅니다.
    *   *처음 실행 시 권한 허용 팝업이 뜰 수 있습니다. [권한 검토] -> 계정 선택 -> [고급] -> [이동(안전하지 않음)] -> [허용]을 순서대로 눌러주세요.*
7.  시트로 돌아가 보면 **D열**에 등급이 쫙 입력되어 있을 거예요!

### 💡 로직 설명 (개발자의 팁)
이 코드는 **'이탈 위험'을 가장 먼저 체크**하도록 짰습니다.
*   이유: 아무리 구매 횟수가 많아도(VIP 조건), 최근 6개월간 방문하지 않았다면 다시 불러오는 게 더 급한 과제이기 때문입니다.
*   만약 VIP인 것을 더 중요하게 표시하고 싶다면, 코드 내의 `if`와 `else if` 순서를 바꾸면 됩니다.

궁금한 점이 있거나 조건(예: 금액 기준 추가)을 바꾸고 싶다면 언제든 말씀해 주세요!