# 민순의 요청

```text
* 역할: 너는 앱스 스크립트 개발자야.
* 상황: 시트의 '구매 횟수'와 '마지막 구매일' 데이터를 기준으로 고객 등급을 자동으로 매기고 싶어. 엑셀 함수도 잘 모르는 초보자야.
* 과업:
  1. 데이터를 읽어 VIP(3회 이상), 이탈 위험(180일 경과) 등을 판단하는 로직을 짜 줘.
  2. 판단된 등급을 시트에 자동 업데이트하는 코드를 작성해 줘.
* 제약: 초보자도 이해할 수 있게 코드에 상세한 주석을 달아 줘. 주석은 '왜 이 코드가 필요한지' 설명해 줘.
* 출력: 앱스 스크립트 코드 블록
```

# 제미나이의 응답

안녕하세요! 앱스 스크립트 개발자입니다. 엑셀 함수가 어렵게 느껴지신다면, 오히려 우리가 원하는 대로 작동하는 스크립트를 짜는 게 더 명확하고 쉬울 수 있습니다.

초보자도 쉽게 이해하고 수정할 수 있도록, **"왜 이 줄이 필요한지"** 꼼꼼하게 주석을 달아 코드를 작성했습니다.

### 📋 사전 준비 (시트 데이터 구조)
코드가 올바르게 작동하려면 시트가 아래와 같은 순서로 되어 있다고 가정합니다. (만약 순서가 다르다면 코드 내의 숫자를 조금 바꿔야 합니다.)

*   **A열:** 고객명 (사용 안 함, 참고용)
*   **B열:** 구매 횟수 (숫자)
*   **C열:** 마지막 구매일 (날짜 형식)
*   **D열:** **고객 등급 (여기에 결과가 자동으로 입력됩니다)**

---

### 💻 앱스 스크립트 코드

아래 코드를 복사해서 앱스 스크립트 편집기(`확장 프로그램` > `Apps Script`)에 붙여넣으세요.

```javascript
function calculateCustomerGrade() {
  // 1. 현재 활성화된 엑셀(스프레드시트)과 시트를 가져옵니다.
  // 이유: 컴퓨터에게 "지금 보고 있는 이 시트에서 작업해"라고 알려줘야 하기 때문입니다.
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();

  // 2. 시트에 있는 데이터가 몇 번째 줄까지 있는지 확인합니다.
  // 이유: 데이터가 10명인데 1000줄을 검사하면 시간이 오래 걸리므로, 딱 데이터가 있는 곳까지만 작업하기 위함입니다.
  var lastRow = sheet.getLastRow();

  // 데이터가 헤더(제목)만 있고 내용이 없다면 작업을 중단합니다.
  if (lastRow < 2) {
    return;
  }

  // 3. B열(구매횟수)과 C열(마지막 구매일)의 데이터를 가져옵니다.
  // 범위 설정: 2번째 줄부터(헤더 제외), B열(2번째 열)부터 C열(3번째 열)까지 가져옵니다.
  // 이유: 셀을 하나씩 읽으면 속도가 느려지므로, 필요한 데이터를 한 번에 '통'으로 가져오는 게 효율적입니다.
  var dataRange = sheet.getRange(2, 2, lastRow - 1, 2); 
  var dataValues = dataRange.getValues();

  // 4. 등급 결과를 담을 빈 바구니(리스트)를 만듭니다.
  // 이유: 계산된 등급을 바로 시트에 적지 않고, 모아뒀다가 한 번에 적는 것이 훨씬 빠르기 때문입니다.
  var grades = [];

  // 5. 오늘 날짜를 확인합니다.
  // 이유: '마지막 구매일'로부터 며칠이 지났는지 계산하려면 기준이 되는 오늘 날짜가 필요합니다.
  var today = new Date();

  // 6. 가져온 데이터를 한 줄씩 검사합니다. (반복문)
  // 이유: 고객 한 명 한 명의 데이터를 확인해서 등급을 매겨야 하기 때문입니다.
  for (var i = 0; i < dataValues.length; i++) {
    
    // 현재 줄의 구매 횟수 (컴퓨터는 0부터 세기 때문에 0이 첫 번째 데이터인 B열입니다)
    var count = dataValues[i][0]; 
    
    // 현재 줄의 마지막 구매일 (1이 두 번째 데이터인 C열입니다)
    var lastDate = new Date(dataValues[i][1]);
    
    // 날짜 차이 계산 (밀리초 단위 차이를 일 단위로 변환)
    // 이유: 컴퓨터는 날짜를 아주 큰 숫자(밀리초)로 기억하므로, 이를 '일(Day)'로 바꿔줘야 합니다.
    var timeDiff = today.getTime() - lastDate.getTime();
    var daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24)); // 1000ms * 3600초 * 24시간 = 1일

    var grade = ""; // 등급을 저장할 변수

    // 7. 등급 판단 로직 (여기가 핵심입니다!)
    // 순서가 중요합니다. 가장 급한 '이탈 위험'부터 체크합니다.
    
    if (daysDiff >= 180) {
      // 마지막 구매일로부터 180일 이상 지났다면 무조건 '이탈 위험'
      grade = "이탈 위험";
    } else if (count >= 3) {
      // 이탈 위험이 아니면서, 구매 횟수가 3회 이상이면 'VIP'
      grade = "VIP";
    } else {
      // 위 조건에 해당하지 않으면 '일반'
      grade = "일반";
    }

    // 판단된 등급을 바구니에 담습니다. (배열 형태여야 시트에 입력 가능)
    grades.push([grade]);
  }

  // 8. 계산된 등급을 D열에 한 번에 입력합니다.
  // 위치: 2번째 줄, 4번째 열(D열)부터 시작해서 데이터 개수만큼 입력
  // 이유: 아까 모아둔 바구니(grades)를 시트에 쏟아붓는 과정입니다.
  sheet.getRange(2, 4, grades.length, 1).setValues(grades);
  
  // 완료 알림 메시지 띄우기 (선택 사항)
  Browser.msgBox("고객 등급 업데이트가 완료되었습니다!");
}
```

### 🚀 사용 방법

1.  구글 스프레드시트 상단 메뉴에서 **`확장 프로그램` > `Apps Script`**를 클릭합니다.
2.  편집기 화면이 나오면 기존 코드를 지우고, **위의 코드를 복사해서 붙여넣습니다.**
3.  상단의 디스켓 아이콘(💾)을 눌러 저장합니다. (프로젝트 이름은 아무거나 상관없습니다.)
4.  상단 실행 버튼 옆의 함수 선택 박스에서 `calculateCustomerGrade`를 선택하고 **`실행`** 버튼을 누릅니다.
5.  (처음 실행 시) 권한 검토 창이 뜨면 **`권한 검토` > 계정 선택 > `고급` > `(프로젝트 이름)으로 이동(안전하지 않음)` > `허용`**을 순서대로 클릭합니다.
6.  시트로 돌아와 보면 D열에 등급이 쫙 입력되어 있을 거예요!

### 💡 로직 설명 (우선순위)

이 코드는 아래 순서대로 판단합니다.

1.  **1순위 (이탈 위험):** 마지막 구매일이 180일 넘게 지났나요? -> 맞다면 무조건 **"이탈 위험"** (VIP 조건이 되어도 이탈 위험이 우선입니다).
2.  **2순위 (VIP):** 1순위가 아니라면, 구매 횟수가 3회 이상인가요? -> 맞다면 **"VIP"**.
3.  **3순위 (일반):** 위 두 가지 모두 아니라면 **"일반"**.

혹시 기준(180일, 3회 등)을 바꾸고 싶으시면 코드 중간에 있는 숫자만 살짝 바꿔주시면 됩니다. 성공하시길 바랍니다!