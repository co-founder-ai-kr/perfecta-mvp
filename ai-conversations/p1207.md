# 민순의 요청

```text
* 역할: 너는 데이터 엔지니어야.
* 상황: 실수로 데이터를 날릴까 봐 매일 새벽 3시에 구글 시트를 백업하고 싶어.
* 과업: 현재 사용 중인 구글 시트를 복사해서, 구글 드라이브의 'Backup' 폴더에 저장하는 스크립트를 짜 줘.
* 제약: 파일 이름 뒤에 오늘 날짜(YYYY-MM-DD)가 자동으로 붙게 해 줘.
* 출력: Apps Script 코드
* 입력: [백업할 구글 시트 이름과 저장할 구글 드라이브 폴더 이름]
 (예시: 백업할 시트 이름 '고객 주문 내역', 저장할 폴더 이름 'Backup')
```

# 제미나이의 응답

안녕하세요. 데이터 엔지니어입니다.

요청하신 대로 구글 시트를 지정된 'Backup' 폴더에 날짜를 붙여 자동으로 저장하는 Google Apps Script 코드를 작성해 드립니다.

이 코드는 **파일 이름으로 원본을 찾고**, **폴더 이름으로 저장 경로를 찾아** 복사본을 생성합니다.

### 🛠️ Google Apps Script 코드

아래 코드를 복사하여 구글 시트의 **확장 프로그램 > Apps Script**에 붙여넣으세요.

```javascript
function dailyBackup() {
  // ==========================================
  // [설정 영역] 이곳에 파일명과 폴더명을 입력하세요
  // ==========================================
  const SOURCE_FILE_NAME = '고객 주문 내역'; // 백업할 구글 시트 이름
  const BACKUP_FOLDER_NAME = 'Backup';     // 저장할 구글 드라이브 폴더 이름
  // ==========================================

  try {
    // 1. 오늘 날짜 포맷 생성 (YYYY-MM-DD)
    const today = new Date();
    const formattedDate = Utilities.formatDate(today, Session.getScriptTimeZone(), "yyyy-MM-dd");
    
    // 2. 백업 폴더 찾기
    const folders = DriveApp.getFoldersByName(BACKUP_FOLDER_NAME);
    let backupFolder;
    
    if (folders.hasNext()) {
      backupFolder = folders.next();
    } else {
      // 폴더가 없으면 에러 로그를 남기고 종료 (또는 자동 생성 로직 추가 가능)
      console.error("오류: '" + BACKUP_FOLDER_NAME + "' 폴더를 찾을 수 없습니다.");
      return;
    }

    // 3. 원본 파일 찾기
    // (이 스크립트가 시트에 연동되어 있다면 getActiveSpreadsheet()를 쓰는 것이 더 안전하지만,
    // 요청하신 대로 '이름'을 기준으로 파일을 찾습니다.)
    const files = DriveApp.getFilesByName(SOURCE_FILE_NAME);
    let sourceFile;

    if (files.hasNext()) {
      sourceFile = files.next();
    } else {
      console.error("오류: '" + SOURCE_FILE_NAME + "' 파일을 찾을 수 없습니다.");
      return;
    }

    // 4. 파일 복사 및 이름 변경
    // 새 파일 이름: 원본이름_YYYY-MM-DD
    const newFileName = sourceFile.getName() + "_" + formattedDate;
    
    sourceFile.makeCopy(newFileName, backupFolder);
    
    console.log("성공: " + newFileName + " 파일이 백업되었습니다.");

  } catch (e) {
    console.error("시스템 오류 발생: " + e.toString());
  }
}
```

---

### ⏰ 매일 새벽 3시에 실행되도록 설정하는 법 (트리거 설정)

코드를 저장한 후, 실제로 매일 새벽 3시에 자동으로 돌아가게 하려면 **트리거(Trigger)**를 설정해야 합니다.

1.  Apps Script 편집기 왼쪽 메뉴에서 **시계 아이콘 (트리거)** 클릭.
2.  오른쪽 하단 **[+ 트리거 추가]** 버튼 클릭.
3.  설정 창에서 다음과 같이 선택:
    *   **실행할 함수:** `dailyBackup`
    *   **배포:** `Head`
    *   **이벤트 소스:** `시간 기반`
    *   **트리거 유형:** `일 단위 타이머`
    *   **시간대:** `오전 3시 ~ 4시`
4.  **[저장]** 클릭 (권한 요청 팝업이 뜨면 허용해 주세요).

### ⚠️ 엔지니어의 조언 (주의사항)
1.  **폴더 생성:** 구글 드라이브에 `Backup`이라는 폴더가 미리 생성되어 있어야 합니다.
2.  **중복 이름:** 만약 구글 드라이브 내에 '고객 주문 내역'이라는 파일이 여러 개라면, 스크립트는 가장 먼저 발견된 파일을 백업합니다. (가능하면 파일 ID를 사용하는 방식이 더 안전합니다.)
3.  **권한:** 스크립트를 처음 실행할 때 `DriveApp` 접근 권한을 승인해야 합니다. `▷ 실행` 버튼을 눌러 수동으로 한 번 테스트해보세요.