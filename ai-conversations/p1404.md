# 민순의 요청

```text
* 역할: 너는 노련한 앱스 스크립트 개발자야.
* 상황: 매일 아침 트렌드 뉴스를 검색하느라 시간을 너무 많이 써. 이 시간을 아껴서 제품 기획에 쓰고 싶어.
* 과업: 
  1. 구글 뉴스 RSS에서 특정 키워드 기사를 가져오는 코드를 짜 줘.
  2. 제미나이 API로 "3줄 요약"을 요청해서 구글 독에 저장하는 기능까지 넣어 줘.
* 제약: 
  - API 키는 코드에 직접 쓰지 말고 '스크립트 속성'에서 가져오도록 해 줘.
  - 초보자도 복사해서 바로 쓸 수 있게 주석을 달아 줘.
* 출력: 앱스 스크립트 코드 (코드 블록)
* 입력: [검색 키워드]
 (예시: 선물 추천)
```

# 제미나이의 응답

반갑습니다. 노련한 앱스 스크립트 개발자입니다.

매일 아침 반복되는 뉴스 검색 업무를 자동화하여 기획에 집중하고 싶으시군요. 아주 훌륭한 접근입니다. 구글 뉴스 RSS를 통해 최신 정보를 긁어오고, 제미나이(Gemini)의 지능을 빌려 요약한 뒤, 구글 닥스에 깔끔하게 정리하는 스크립트를 작성해 드리겠습니다.

초보자도 쉽게 따라 할 수 있도록 **설정 방법**과 **코드**를 나누어 설명해 드릴게요.

### 1. 사전 준비 (API 키 설정)

코드를 실행하기 전에, 보안을 위해 API 키를 스크립트 내부에 직접 적지 않고 **'스크립트 속성'**에 저장해야 합니다.

1.  **Google AI Studio**에서 Gemini API 키를 발급받습니다.
2.  앱스 스크립트 편집기에서 왼쪽 메뉴의 **톱니바퀴 아이콘 (프로젝트 설정)**을 클릭합니다.
3.  스크롤을 내려 **'스크립트 속성'** 섹션에서 **[스크립트 속성 추가]**를 클릭합니다.
4.  **속성**: `GEMINI_API_KEY`
5.  **값**: (발급받은 API 키 붙여넣기)
6.  **[스크립트 속성 저장]**을 클릭합니다.

---

### 2. 앱스 스크립트 코드

아래 코드를 복사해서 `Code.gs` 파일에 붙여넣으세요.
`SEARCH_KEYWORD` 변수만 원하시는 검색어(예: "선물 추천")로 변경하면 바로 작동합니다.

```javascript
/**
 * [설정 영역]
 * 검색하고 싶은 키워드와 가져올 기사 개수를 설정하세요.
 */
const SEARCH_KEYWORD = "선물 추천"; // 여기에 원하는 키워드 입력
const MAX_ARTICLES = 5; // 요약할 기사 최대 개수 (너무 많으면 실행 시간이 길어질 수 있음)

/**
 * 메인 실행 함수
 * 이 함수를 선택하고 '실행' 버튼을 누르세요.
 */
function createTrendReport() {
  // 1. 스크립트 속성에서 API 키 가져오기 (보안)
  const scriptProperties = PropertiesService.getScriptProperties();
  const apiKey = scriptProperties.getProperty('GEMINI_API_KEY');

  if (!apiKey) {
    throw new Error("API 키가 설정되지 않았습니다. 프로젝트 설정 > 스크립트 속성에서 'GEMINI_API_KEY'를 추가해주세요.");
  }

  // 2. 구글 뉴스 RSS 데이터 가져오기
  Logger.log(`'${SEARCH_KEYWORD}' 키워드로 뉴스를 검색합니다...`);
  const articles = fetchGoogleNews(SEARCH_KEYWORD);

  if (articles.length === 0) {
    Logger.log("검색된 기사가 없습니다.");
    return;
  }

  // 3. 구글 닥스 생성 및 제목 설정
  const docTitle = `[트렌드 리포트] ${SEARCH_KEYWORD} - ${new Date().toLocaleDateString()}`;
  const doc = DocumentApp.create(docTitle);
  const body = doc.getBody();
  
  // 문서 헤더 작성
  body.insertParagraph(0, docTitle).setHeading(DocumentApp.ParagraphHeading.HEADING1);
  body.appendParagraph(`생성 일시: ${new Date().toLocaleString()}`);
  body.appendHorizontalRule();

  // 4. 각 기사를 순회하며 제미나이로 요약하고 문서에 기록
  // 설정한 개수(MAX_ARTICLES)만큼만 처리
  const processCount = Math.min(articles.length, MAX_ARTICLES);

  for (let i = 0; i < processCount; i++) {
    const article = articles[i];
    Logger.log(`(${i + 1}/${processCount}) 기사 요약 중: ${article.title}`);

    // 제미나이에게 요약 요청
    const summary = callGeminiSummary(apiKey, article.title, article.description);

    // 문서에 내용 추가
    const titlePara = body.appendParagraph(`${i + 1}. ${article.title}`);
    titlePara.setHeading(DocumentApp.ParagraphHeading.HEADING2);
    
    // 링크 추가
    const linkPara = body.appendParagraph("기사 원문 보기");
    linkPara.setLinkUrl(article.link);
    
    // 요약 내용 추가 (스타일 적용)
    body.appendParagraph("💡 3줄 요약:");
    const summaryPara = body.appendParagraph(summary);
    summaryPara.setAttributes({
      [DocumentApp.Attribute.ITALIC]: true,
      [DocumentApp.Attribute.FOREGROUND_COLOR]: '#333333'
    });
    
    body.appendParagraph(""); // 공백 추가
  }

  // 5. 완료 로그 및 문서 URL 출력
  Logger.log("작업 완료!");
  Logger.log(`생성된 문서 URL: ${doc.getUrl()}`);
}

/**
 * 구글 뉴스 RSS를 파싱하여 기사 목록을 반환하는 함수
 */
function fetchGoogleNews(keyword) {
  // 한국어(ko), 한국(KR) 설정으로 검색
  const encodedKeyword = encodeURIComponent(keyword);
  const rssUrl = `https://news.google.com/rss/search?q=${encodedKeyword}&hl=ko&gl=KR&ceid=KR:ko`;
  
  try {
    const response = UrlFetchApp.fetch(rssUrl);
    const xml = response.getContentText();
    const document = XmlService.parse(xml);
    const root = document.getRootElement();
    const channel = root.getChild('channel');
    const items = channel.getChildren('item');
    
    const newsList = [];
    
    items.forEach(item => {
      const title = item.getChildText('title');
      const link = item.getChildText('link');
      // HTML 태그 제거 (간단한 정규식 사용)
      let description = item.getChildText('description') || "";
      description = description.replace(/<[^>]*>?/gm, ''); 

      newsList.push({
        title: title,
        link: link,
        description: description
      });
    });

    return newsList;

  } catch (e) {
    Logger.log("RSS 가져오기 실패: " + e.toString());
    return [];
  }
}

/**
 * 제미나이(Gemini) API를 호출하여 3줄 요약을 요청하는 함수
 */
function callGeminiSummary(apiKey, title, content) {
  const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`;
  
  // 프롬프트 구성
  const prompt = `
    다음 뉴스 기사의 제목과 내용을 바탕으로 핵심 내용을 '3줄 요약' 해줘.
    결과는 반드시 한국어로 작성하고, 각 줄은 '- '로 시작하는 글머리 기호 형식이어야 해.
    
    [제목]: ${title}
    [내용]: ${content}
  `;

  const payload = {
    "contents": [{
      "parts": [{
        "text": prompt
      }]
    }]
  };

  const options = {
    "method": "post",
    "contentType": "application/json",
    "payload": JSON.stringify(payload),
    "muteHttpExceptions": true
  };

  try {
    const response = UrlFetchApp.fetch(apiUrl, options);
    const json = JSON.parse(response.getContentText());
    
    if (json.candidates && json.candidates.length > 0) {
      return json.candidates[0].content.parts[0].text;
    } else {
      return "요약 생성 실패 (API 응답 없음)";
    }
  } catch (e) {
    Logger.log("Gemini API 호출 오류: " + e.toString());
    return "요약 생성 중 오류 발생";
  }
}
```

### 3. 사용 방법

1.  위 코드를 붙여넣은 후, 상단의 `SEARCH_KEYWORD` 변수를 원하는 검색어(예: "선물 추천", "AI 트렌드")로 수정합니다.
2.  상단 툴바의 함수 선택 박스에서 `createTrendReport`를 선택합니다.
3.  **[실행]** 버튼을 클릭합니다. (최초 실행 시 권한 승인 팝업이 뜨면 승인해주세요.)
4.  실행이 완료되면 하단 **실행 로그**에 `생성된 문서 URL`이 표시됩니다. 해당 링크를 클릭하면 요약된 리포트를 볼 수 있습니다.

### 💡 개발자의 팁
*   **트리거 설정:** 매일 아침 자동으로 실행되게 하려면, 왼쪽 메뉴의 '트리거(시계 아이콘)'에서 `createTrendReport` 함수를 '시간 기반 트리거(일일 타이머)'로 설정하세요. 아침에 출근하면 구글 드라이브에 리포트가 딱 도착해 있을 겁니다.
*   **모델 변경:** 코드는 가성비가 좋은 `gemini-1.5-flash` 모델을 사용했습니다. 더 깊이 있는 분석이 필요하면 `gemini-1.5-pro`로 변경하셔도 됩니다.

이제 뉴스 검색 시간을 아껴서 더 멋진 제품을 기획하시길 바랍니다!