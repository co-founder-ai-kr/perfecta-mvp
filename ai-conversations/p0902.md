# 민순의 요청

```text
* 역할: 너는 꼼꼼한 보안 전문가이자 앱스 스크립트 배포 마스터야.
* 상황: HTML 파일을 'Netlify'에 배포하려고 하는데, 소스 코드에 내 데이터 주소가 노출되거나 권한 문제가 생길까 봐 걱정돼.
* 과업:
  1. 코드에 남들이 보면 안 되는 비밀 키 같은 게 있는지 확인해 줘.
  2. 내 웹 사이트 주소에서 온 요청만 받아주고, 다른 곳에서는 데이터를 못 가져가게 막는 방법을 알려 줘.
  3. 'CORS' 에러가 나지 않도록 앱스 스크립트 권한 설정을 어떻게 해야 하는지 버튼 위치부터 차근차근 알려 줘.
* 제약: 초보자도 이해하기 쉽게 설명해 줘.
* 출력:
  1. 보안 점검 리포트
  2. 권한 설정 가이드
* 입력: [index.html 코드와 앱스 스크립트 코드 전체 붙여넣기]
```

# 제미나이의 응답

반갑습니다! 꼼꼼한 **보안 전문가**이자 **앱스 스크립트 배포 마스터**입니다. 🕵️‍♂️💻

지금 **[index.html 코드와 앱스 스크립트 코드]**가 입력되지 않아서, 제가 직접 코드를 눈으로 보고 분석해 드릴 수는 없는 상황이에요.

하지만 걱정 마세요! **보통 이런 상황에서 가장 많이 발생하는 보안 실수와 해결 방법**을 완벽하게 정리해 드릴게요. 코드를 주시면 더 정확하게 봐드릴 수 있지만, 아래 가이드만 따라 하셔도 90% 이상의 문제는 해결됩니다.

---

### 1. 🛡️ 보안 점검 리포트 (자가 진단용)

코드를 붙여넣어 주시면 제가 직접 봐드리겠지만, 지금은 아래 항목들을 직접 체크해 보세요.

**⚠️ 절대 노출되면 안 되는 것들 (HTML 파일 확인)**
*   **API Key:** `AIza...`로 시작하는 구글 맵, Firebase 등의 키가 코드에 그대로 적혀 있나요? (Netlify 환경변수 기능을 써야 합니다.)
*   **Spreadsheet ID:** `1A2b3C...` 같은 긴 시트 ID가 HTML 자바스크립트 안에 있나요?
    *   *해결책:* 시트 ID는 HTML이 아니라 **앱스 스크립트(.gs) 파일 안에만** 적어야 안전합니다.
*   **개인정보:** 본인의 이메일, 전화번호가 주석(`<!-- -->` 또는 `//`) 처리에 남아있지 않나요?

**⚠️ 앱스 스크립트 URL (Web App URL)**
*   `https://script.google.com/macros/s/.../exec` 주소는 HTML에 포함되어야 작동하므로 **노출되는 것이 필연적**입니다.
*   따라서 **"주소가 털려도 안전하게 만드는 것"**이 핵심입니다. (아래 2번에서 설명)

---

### 2. 🚧 내 사이트에서만 요청받기 (도용 방지)

HTML 소스 보기를 하면 누구나 앱스 스크립트 주소를 볼 수 있습니다. 나쁜 마음을 먹은 사람이 이 주소로 엉뚱한 데이터를 보내거나 데이터를 긁어갈 수 있죠. 이를 막는 가장 현실적인 방법입니다.

**앱스 스크립트(.gs) 파일의 `doGet` 또는 `doPost` 함수를 이렇게 수정하세요.**

앱스 스크립트는 완벽한 '도메인 차단' 기능을 제공하지 않지만, **CORS(교차 출처 리소스 공유)** 원리를 이용해 1차적인 방어막을 칠 수 있습니다.

> **초보자를 위한 설명:** "내 홈페이지 주소(Origin)가 아니면 데이터를 주지 마!"라고 명령하는 것은 어렵지만(구글 정책상), 최소한 **"이상한 데이터가 들어오면 에러를 뱉어라"**라고 할 수는 있습니다.

가장 추천하는 방법은 **"단순한 비밀번호(토큰) 검사"**를 추가하는 것입니다.

**[HTML 코드 수정]**
데이터를 보낼 때 `auth`라는 이름으로 나만의 비밀번호를 같이 보냅니다.
```javascript
fetch("https://script.google.com/.../exec?auth=mySecretPassword123&action=getData")
// ... 나머지 코드
```

**[앱스 스크립트(.gs) 수정]**
받는 쪽에서 비밀번호가 맞는지 확인합니다.
```javascript
function doGet(e) {
  // 1. 보안 검사: 비밀번호가 틀리면 쫓아냅니다.
  if (e.parameter.auth !== "mySecretPassword123") {
    return ContentService.createTextOutput("접근 권한이 없습니다. (Wrong Auth)");
  }

  // 2. 비밀번호가 맞으면 원래 하려던 작업을 수행합니다.
  // ... (데이터 가져오기 로직)
  
  return ContentService.createTextOutput(JSON.stringify(result))
    .setMimeType(ContentService.MimeType.JSON);
}
```
*   *참고:* 이 방법도 HTML 소스를 보면 비밀번호가 보이지만, 단순히 URL만 복사해서 브라우저 주소창에 넣는 초보적인 공격은 막을 수 있습니다.

---

### 3. ⚙️ CORS 에러 없는 권한 설정 가이드 (필독!)

Netlify에 배포했을 때 **"CORS Error"**가 뜨면서 작동이 안 되는 이유는 100% **권한 설정** 때문입니다. 버튼 위치 하나하나 알려드릴게요.

**앱스 스크립트 화면 우측 상단 [배포] 버튼을 누르세요.**

1.  **[배포]** 파란 버튼 클릭 -> **[새 배포]** 선택
2.  왼쪽 톱니바퀴 아이콘 클릭 -> **[웹 앱]** 선택
3.  **설명:** (예: 버전 1.0 - Netlify 배포용)
4.  **다음 두 가지 설정이 가장 중요합니다! (별 다섯 개 ⭐⭐⭐⭐⭐)**

    *   **실행 사용자 (Execute as):**
        *   👉 **`나 (Me)`** 를 선택하세요.
        *   *이유:* 방문자는 시트 권한이 없어도, 스크립트가 **'주인장(나)'의 권한을 빌려서** 대신 데이터를 가져와야 하기 때문입니다.

    *   **액세스 권한 승인 (Who has access):**
        *   👉 **`모든 사용자 (Anyone)`** 를 선택하세요.
        *   *주의:* 'Google 계정이 있는 모든 사용자'를 선택하면 안 됩니다! 로그인 안 한 방문자도 볼 수 있어야 하니까요.

5.  **[배포]** 버튼 클릭
6.  **[액세스 승인]** 창이 뜨면?
    *   본인 구글 계정 선택 -> **"확인되지 않은 앱"** 경고창이 뜹니다. (놀라지 마세요!)
    *   왼쪽 하단 **`고급(Advanced)`** 클릭 -> 맨 아래 **`...로 이동(안전하지 않음)`** 클릭 -> **`허용`** 클릭.

7.  **웹 앱 URL 복사:**
    *   이제 생성된 `https://script.google.com/.../exec` 주소를 복사해서 HTML 파일의 `fetch` 부분에 붙여넣으세요.

---

**💡 마스터의 조언:**
코드를 주시면 **"혹시 시트 ID가 노출되었는지"**, **"HTML에서 데이터를 요청하는 방식이 안전한지"** 바로 진단해 드릴 수 있습니다.

지금 바로 **[index.html]**과 **[Code.gs]** 내용을 댓글로 붙여넣어 주세요! 🕵️‍♂️